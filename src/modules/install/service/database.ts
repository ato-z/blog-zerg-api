import { DataBase, KvStore } from '@atoz/kvstore';
import { admin } from '@/config/admin';
import { date } from '@/helper/functions';
import { ServiceManagement } from '@/service/Management';

const cover =
  'data:image/jpeg;base64,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';

export class ServiceDataBase {
  protected db: DataBase;
  constructor(private readonly kvEnv: Env) {
    this.db = new DataBase(kvEnv.BLOG_DATABASE);
  }

  /**
   * 创建数据列表
   */
  async install() {
    const tableNames = ['management'];
    const { db } = this;
    const createStates: Array<Promise<void>> = [];
    for (const tableName of tableNames) {
      createStates.push(db.createTable(tableName));
    }

    await Promise.all(createStates);
  }

  /**
   * 写入初始的登录用户
   */
  async withAccount() {
    const { kvEnv } = this;
    const management = new KvStore<TableManagementS, TableManagementR>(
      kvEnv.BLOG_MANAGEMENT,
    );

    await management.push(
      admin.name,
      {
        cover,
        password: ServiceManagement.encodePassword(
          admin.name,
          admin.password,
          admin.level,
        ),
        status: 1,
        createDate: date('y-m-d h:i:s'),
      },
      {
        name: admin.name,
        level: admin.level,
        password: admin.password,
      },
    );
  }
}
